<!-- 
File: editor.html
Author: Nikhil Singhal
Date: July 1, 2016

Sets up the editor page so it can be used to display and modify dictionary entries in
the staging and official dictionaries.

The main segments are #uploadPDFDiv, a floating popup that asks the user to input pdfs for
scanning, menuArea, the area with control buttons and the search area, viewArea, the section
that contains the majority of the screen with the staging table, and officialViewer, the
floating footer that displays a table with published definitions of the currently selected word.

This file requires js/editor.js for functionality, and js/editor.js requires jQuery, which
is attained through google dynamic loading, js/pdfjs/pdf.js, js/pdfToText.js, and
js/findUniqueWords.js. Also requires css/editor.css for style and backend.php for backend
functionality.

To operate the page, first log in (not set up yet). Then you can click the "Upload PDF" button
and upload a pdf, which will be transmitted to the database and added to staging. Then you
can search for certain words and modify any of the staging words (any modifications to a
single field will immediately be transmitted and saved, otherwise the user will be alerted
and the change will be reverted), though only permitted fields (fields such as 'id' and
the last modifier cannot be modified). Since searches are likely to return too many results
to load or display, the server only returns a small page of a few words at a time. To view
more words, press the next/previous page buttons at the bottom of the staging table or input
a page number. To view published definitions of staging words, click the "selected/unselected"
button on the left side of the row and those entries will appear in the footer. To edit the
published entries in the footer, click on the "edit" button on the left side of the row and
they will be moved to the staging dictionary where they can be edited. Once you are done
editing, simply click the "publish" button and say you are sure and all accepted changes will
be transfered to the official dictionary.

The status column shows the current status of a word:
if the word is in the official looma dictionary database it is considered "published"/"unedited"
and this is displayed directly in the column in the footer or in the left button in the column
in the staging table. Clicking this button will have no effect.

if the word is in the staging dictionary and has been deleted, the left button in the status
column will say "deleted" and the "delete" button will change to "re add", and clicking
either button will re-add it and restore its previous status. By deleted, we mean that
the definition will be COMPLETELY REMOVED FROM BOTH DICTIONARIES when published.


if the word is in the staging dictionary (whether modified or not) and not deleted
and has been accepted, meaning that it is set to be transfered to the
official dictionary when the page is published, it will say "accepted" in the button on the
left. Clicking this button will toggle it between "accepted" and its previous status (which
must be "modified" or "added")

if the word is in the staging dictionary and not been deleted or accepted, but has been modified
from its original state (whether that was its original value after being added or the value
it had in the official dictionary), the left button will say "modified", and clicking it
will toggle it between "accepted" and "modified".

if the word is in the staging dictionary and has just been added (eg from a pdf, not the
official database), the left button will say "added", and clicking it will toggle it between
"accepted" and "added"


if delete is pressed, the status will change to deleted (see above). if the cancel button is
pressed and the user confirms, the entry selected will IMMEDIATELY be deleted from the STAGING
dictionary. If it had a previous version in the official dictionary, that version will NOT be
modified or removed.




 -->


<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Looma Dictionary Editor</title>
<script src="js/jquery.min.js"></script>
<script src="js/pdfjs/pdf.js"></script>
<script src="js/pdfToText.js"></script>
<script src="js/findUniqueWords.js"></script>
<script src="js/editor.js"></script>
<link rel="stylesheet" href="css/editor.css">
</head>
<body>

<div id="uploadPDFDiv" class="popupDiv">
	<button class="closePopupButton" onclick="hideUploadDiv()"> X </button> <br>
	<input type="file" id="pdfInput" title="Choose the file containing the words you wish to upload.">
	<br>
	<pre class="inline" title="Type the prefix for the chapter id, which should include the grade level, then subject abbreviation, and possibly the chapter number if you are only loading one chapter">ch_id prefix: <input type="text" id="prefixInput" placeholder="ex. 3EN"></pre>
	<br>
	<pre class="inline" title="Check this box if you want the program to automatically parse where chapters start and end. Make sure you read the user manual to know the limitations of this feature">Autogenerate ch_ids: <input type="checkbox" id="autoChidCheck" onclick="changeAutoGen()"></pre>
	<br>
	<pre id="chidInputLabel" class="inline" title="If you're loading an entire textbook, type the page numbers (in the pdf) of the start of each chapter. If you're just loading 1 chapter, don't type anything here but include the chapter in the 'ch_id prefix' field">Page numbers: <input type="text" id="chapInput" placeholder="ex. 12, 14, 17, 23"></pre>
	<br>
	<pre class="inline" title="Input the page number (in the pdf) you want to start with. If you don't type anything, defaults to page 1">Start: <input type="number" id="startPageNumber" class="quarter"> </pre>
	<pre class="inline" title="Input the page number (in the pdf) you want to end with. If you don't type anything, defaults to the last page">End: <input type="number" id="endPageNumber" class="quarter"> </pre>
	<br>
	<button id="processPDFButton" onclick="processPDF()" title="Click here to start processing and uploading this PDF. After clicking this, you should not exit the page or reload until it is finished or you press cancel">Process PDF</button>
	<br>
	<p id="progressDisplay" class="centeredText alwaysShow"> </p>
	<button id="cancelUploadButton" class="alwaysClickable alwaysShow" onclick="cancelUpload()"
			title="Click here to cancel the current upload. Entries that have already been added from this upload will not be removed">Cancel</button>
</div>

<div id="addWordDiv" class="popupDiv">
	<button class="closePopupButton" onclick="hideAddWordDiv()"> X </button> <br>
	<pre class="inline">Word: </pre>
	<input type="text" id="newWordInput" placeholder="ex. test">
	<br>
	<input type="button" id="addWordButton" onclick="addSingleWord()" value="Add word and show in editor">
</div>


<div id="menuArea">


	<button id="uploadPDFButton" onclick="showUploadDiv()">Upload PDF</button>
	
	<button id="publishButton" onclick="publish()" class="right">Publish Accepted Changes</button>
	
	<br>
	
	<button id="showWordDivButton" onclick="showAddWordDiv()">Add Single Word</button>
	
	<button id="revertAllButton" onclick="revertStaging()" class="right">Revert All</button>
	
	<div class="centeredSection">
		<input type="text" name="wordPart" id="wordPart" placeholder="Enter Search Term Here">
		<input type="button" value="Search" id="searchButton" onclick="submitSearch()">
		<br><br>
		Added: <input type="checkbox" name="added" id="added">
		Modified: <input type="checkbox" name="modified" id="modified">
		Accepted/Deleted: <input type="checkbox" name="accepted" id="accepted">
	</div>
</div>


<div id="viewArea">
	
	<div id="resultsArea">
		<table id="resultsTable">
			<tr>
				<th class="selectCol">Selected</th>
				<th class="wordCol">Word</th>
				<th class="statCol">Status</th>
				<th class="rootCol">Root Word</th>
				<th class="posCol">POS</th>
				<th class="nepCol">Nepali</th>
				<th class="defCol">Definition</th>
				<th class="ch_idCol">ch_id</th>
				<th class="primCol">Primary</th>
				<th class="modCol">Modified By</th>
				<th class="dateCol">Date Modified</th>
			</tr>
		</table>
	</div>
	
	<div id="pageSwitcherSuper">
		<div id="pageSwitcherSub">
			<input type="button" id="firstPageButton" value="<<<" onclick="switchPage(-2)">
			<input type="button" id="previousPageButton" value="<" onclick="switchPage(-1)">
			<b>Page</b>
			<input type="number" id="pageInput" value="1" min="1" onchange="pageChange()">
			<b>of</b>
			<b id="maxPage"></b>
			<input type="button" id="nextPageButton" value=">" onclick="switchPage(1)">
			<input type="button" id="lastPageButton" value=">>>" onclick="switchPage(2)">
		</div>
	</div>
	
</div>

<div id="officialViewer">
	<div id="footerLabel">
		<span>Published Definitions: &nbsp;&nbsp;</span>
		<div id="officialSearchArea">
			<input type="text" name="wordPart" id="officialSearchBox" placeholder="Enter Search Term Here">
			<input type="button" value="Search" id="officialSearchButton" onclick="submitOfficialSearch()">
		</div>
		<button id="showOverwriteButton" class="toggledOff" onclick="toggleOverwrite();"></button>
	</div>
	<table id="officialTable">
		<tr>
			<th class="editCol"></th>
			<th class="wordCol">Word</th>
			<th class="statCol">Status</th>
			<th class="rootCol">Root Word</th>
			<th class="posCol">POS</th>
			<th class="nepCol">Nepali</th>
			<th class="defCol">Definition</th>
			<th class="ch_idCol">ch_id</th>
			<th class="primCol">Primary</th>
			<th class="modCol">Modified By</th>
			<th class="dateCol">Date Modified</th>
			<th class="otherCol">Other Info</th>
		</tr>
	</table>
</div>



<script>
startup();
</script>

</body>
</html>